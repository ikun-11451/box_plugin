# 开盒插件使用说明

## 命令使用

### 基本命令
```
/盒                # 开盒自己
/盒 @某人          # 开盒指定用户
/盒 123456789      # 开盒指定QQ号用户
/开盒              # 开盒自己（别名）
/开盒 @某人        # 开盒指定用户（别名）
/开盒 123456789    # 开盒指定QQ号用户（别名）
```

### 命令示例
1. 开盒自己：
   ```
   /盒
   ```

2. 开盒他人：
   ```
   /盒 @用户名
   ```
   
3. 通过QQ号开盒：
   ```
   /盒 123456789
   ```

## 配置说明

### 配置文件位置
`config/plugins/box_plugin/config.toml`

### 配置项详解

#### basic - 基础设置
- `only_admin`: bool, default=false
  - 是否仅允许管理员开盒他人
  - 设置为true时，只有管理员可以开盒他人，普通用户只能开盒自己

- `increase_box`: bool, default=false
  - 是否自动开盒新进群的人
  - 当有新成员加入群聊时自动执行开盒操作

- `decrease_box`: bool, default=false
  - 是否自动开盒主动退群的人
  - 当有成员主动退出群聊时自动执行开盒操作

- `clean_cache`: bool, default=false
  - 重载插件时是否清空缓存
  - 设置为true时，每次插件重载都会清空之前的开盒图片缓存

#### groups - 群组设置
- `auto_box_groups`: list, default=[]
  - 自动开盒群聊白名单
  - 只在指定的群聊中启用自动开盒功能
  - 空列表表示在所有群聊中启用

#### protection - 保护设置
- `protect_ids`: list, default=[]
  - 信息保护用户列表
  - 列表中的用户无法被开盒
  - Bot和Bot管理员默认受到保护

#### display - 显示设置
- `display_options`: list
  - 信息显示选项
  - 可选择要显示的用户信息字段：
    - "QQ号"
    - "昵称"
    - "备注"
    - "群昵称"
    - "群头衔"
    - "性别"
    - "生日"
    - "星座"
    - "生肖"
    - "年龄"
    - "血型"
    - "电话"
    - "邮箱"
    - "家乡"
    - "现居"
    - "职业"
    - "个性标签"
    - "风险账号"
    - "机器人账号"
    - "QQVIP"
    - "年VIP"
    - "VIP等级"
    - "群等级"
    - "加群时间"
    - "QQ等级"
    - "注册时间"
    - "签名"

#### recall - 撤回设置
- `recall_time`: int, default=10
  - 撤回时间（秒）
  - 开盒结果发送后自动撤回的时间
  - 设置为0表示不自动撤回

#### library - 高级设置
- `cookie`: string, default=""
  - Library Cookie（高级配置）
  
- `desensitize`: bool, default=false
  - 去敏化（高级配置）
  
- `recall_desen_time`: int, default=5
  - 敏感撤回时间（高级配置）

## 使用示例

### 示例1：基本开盒
用户发送 `/盒 @小明`，插件会：
1. 获取小明的QQ号
2. 调用Onebot API获取小明的信息
3. 生成开盒卡片图片
4. 发送图片到群聊
5. 根据配置自动撤回

### 示例2：自动开盒新成员
当配置了 `increase_box = true` 时：
1. 新成员加入群聊
2. 插件自动获取新成员信息
3. 生成开盒卡片图片
4. 发送到群聊中

### 示例3：保护重要用户
在 `protect_ids` 中添加重要用户的QQ号：
```toml
[protection]
protect_ids = ["123456789", "987654321"]
```
这些用户将无法被开盒。

## 注意事项

1. **权限控制**：建议合理设置 `only_admin` 和 `protect_ids`，避免滥用
2. **隐私保护**：请尊重他人隐私，不要随意开盒他人
3. **API限制**：部分用户信息可能因隐私设置而无法获取
4. **字体文件**：确保 `可爱字体.ttf` 和 `NotoColorEmoji.ttf` 文件存在
5. **依赖安装**：确保已安装 Pillow、emoji、zhdate 等依赖库

## 故障排除

### 问题1：开盒结果只有文本没有图片
- 检查字体文件是否存在
- 检查Pillow库是否正确安装
- 查看日志确认是否有错误信息

### 问题2：无法获取用户信息
- 检查Onebot协议是否正常工作
- 确认机器人是否有权限获取用户信息
- 部分信息可能因用户隐私设置而无法获取

### 问题3：自动开盒功能不工作
- 检查 `increase_box` 和 `decrease_box` 配置
- 确认事件监听是否正常
- 查看日志确认是否有相关错误信息